/*void kbc_asm_ih();*/
/*using _C_LABEL() from <machine/asm.h>*/
#include  <machine/asm.h>

#include "8042.h"

.intel_syntax

.global _C_LABEL(code)
.global _C_LABEL(kbc_asm_ih)
.data

.text
_C_LABEL(kbc_asm_ih):
          xor eax, eax //eax will contain the Status in the first part
          in al, OUT_BUF //The status only has a byte
          cmp al, (PAR_ERR | TO_ERR)) //Comparing the status with the two most significant bits that shows if it is an error
          jz noError //If there is no error, the scancode is valid
          mov byte ptr _C_LABEL(code), 0 //If there is an error, 
noError:  xor eax, eax //Variable that will contain a byte from the scancode
          in al, OUT_BUF //input: ebx has now a byte from the scancode
          mov byte ptr _C_LABEL(code), al
Fim:      ret
